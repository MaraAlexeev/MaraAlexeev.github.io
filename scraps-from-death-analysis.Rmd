---
title: "Today? Alt responses to give the God of Death"
author: "Mara Alexeev"
date: '2021-11-05'
draft: yes
slug: age-of-death-over-time-from-wikipedia
categories: []
tags: []
---

>“There is only one god and his name is death. And there is only one thing we say to death: Not today.”
>
>― Syrio Forel (Game of Thrones S1:Ep6: A golden crown)

While Game of Thrones fans are fond of refusing the God of Death, Wikipedia has lots of data about people who did say: Ok, today is the day.

```{r libraries, message=FALSE, warning=FALSE, echo=FALSE}
library(tidyverse)
library(WikidataQueryServiceR)
library(lubridate)
library(stringr)
library(magrittr)
library(plotly)
library(DT)
library(scales)
library(ggthemes)
```

# Inspiration

In July 2020, my husband presented me with two tweets ([tweet 1](https://twitter.com/patrickc/status/1284582707897364480?ref_src=twsrc%5Etfw) and [tweet 2](https://twitter.com/paulg/status/1284578860827324417)) and challenged me to make some cooler graphs. 

```{r tweet-1, message=FALSE, warning=FALSE, echo=FALSE}
knitr::include_graphics("~/All_of_Maras_R/website/MaraAlexeev.github.io/content/post/2021-06-07-age-of-death-over-time-from-wikipedia/tweet_1.png")
```

```{r tweet-2, message=FALSE, warning=FALSE, echo=FALSE}
knitr::include_graphics("~/All_of_Maras_R/website/MaraAlexeev.github.io/content/post/2021-06-07-age-of-death-over-time-from-wikipedia/tweet_2.png")
```


# Motivations

With this post, I wanted to do three things: 

- See if I could make a more engaging graph than the original twitter post using R

- Learn to pull data using the {WikidataQueryServiceR} package

- Visualize the difference in male and female representation in the data

I work in healthcare data, so often I cannot share my data or analysis for privacy reasons. This post is my way to share some of the techniques I use at work with data that can see the light of day.

Here I will walk you start to finish from data pull to pretty plots to hopefully give you some inspiration for your own data projects.

# Data sources

I originally started working on this analysis and blog post on July 22, 2020, so I have learned a lot of data analytic and programming skills since then, but at the time I had never written a SQL (or one of the many similar SQL-like languages) query outside of an online programming tutorial.

This is the command I used to grab the data from the Wikidata Query Service on November 6, 2021 using the {[WikidataQueryServiceR](https://cran.r-project.org/web/packages/WikidataQueryServiceR/WikidataQueryServiceR.pdf)} package.

```{r getdata2, eval=FALSE, message=FALSE, warning=FALSE}

my_wiki_query <- query_wikidata('SELECT ?item ?dob ?dod ?sex_or_gender WHERE {
  ?item wdt:P31 wd:Q5;
  OPTIONAL { ?item wdt:P570 ?dod }
  OPTIONAL { ?item wdt:P569 ?dob }
  OPTIONAL { ?item wdt:P21 ?sex_or_gender. }
}')

```

```{r load-data, message=FALSE, warning=FALSE, echo=FALSE}
my_wiki_query <- readRDS("~/All_of_Maras_R/website/MaraAlexeev.github.io/my_wiki_query.rds")

count_query <- nrow(my_wiki_query)
```

With this short command, I was able to quite effortlessly pull data on `r count_query` records. As I started out learning R and playing with data, I knew nothing about how to query many of the publicly available sources of data. Being able to pull over 3 million rows of data for a toy analysis is an amazing feat! If you are just starting out in learning R or want to find some great pre-cleaned datasets to work with, check out [Tidy Tuesday](https://github.com/rfordatascience/tidytuesday) and follow people's work on twitter using the [#TidyTuesday hashtag](https://twitter.com/hashtag/TidyTuesday?src=hashtag_click). 

```{r clean, message=FALSE, warning=FALSE, echo=FALSE}

# sex notation
my_wiki_query %<>% 
  mutate(simplified_sex = case_when(
    sex_or_gender == "http://www.wikidata.org/entity/Q6581072" ~ 1, #female
    sex_or_gender == "http://www.wikidata.org/entity/Q6581097" ~ 2, #male
    TRUE ~ 3 #not female, not male
    ))

my_wiki_query %<>% 
  dplyr::distinct(item, .keep_all= TRUE) %>% 
  dplyr::mutate(full_year_of_birth = str_extract(dob, "-?[:digit:]{4}")) %>% 
  dplyr::mutate(full_year_of_death = str_extract(dod, "-?[:digit:]{4}")) %>% 
  dplyr::mutate(approx_age_at_death = as.numeric(full_year_of_death) - as.numeric(full_year_of_birth)) 

my_wiki_query$full_year_of_birth <- as.numeric(my_wiki_query$full_year_of_birth) 
my_wiki_query$full_year_of_death <- as.numeric(my_wiki_query$full_year_of_death)   
my_wiki_query$simplified_sex <- as_factor(my_wiki_query$simplified_sex)

my_wiki_query %<>% mutate(decade_birth = full_year_of_birth %/% 10)
```

# Understanding the data

The first question I had about the distribution of data on various aspects. I decided to limit myself to the year 1000 onward to be somewhat comparable to tweets that inspired this post. Here I created a plot to show the distribution of births. 

```{r, message=FALSE, warning=FALSE, echo=FALSE}
my_wiki_query %>% 
  filter(full_year_of_birth >= 1000 & full_year_of_birth < 2022) %>% 
  filter(simplified_sex == 1 | simplified_sex == 2) %>% 
  ggplot(aes(x = full_year_of_birth)) +
  geom_histogram(binwidth = 10) +
  scale_y_log10(breaks=c(100, 1000, 10000, 100000), labels = c("100", "1000", "10,000", "100,000")) +
  scale_x_continuous(breaks = seq(1000, 2021, 100)) +
  theme_economist() + 
  labs(title = "Distribution of births per year",
       x = "Year",
       y = "Birth count per year",
       subtitle = "Years 1000 to 2021\nLog Scale Y-axis", 
       caption = "Including only records with birth years,\nand restricted to sex of either male or female.") +
  coord_cartesian(ylim = c(100, 200000))
```

Some notable things about the data is the increase of number of available records over time and with an expected drop off as the birth year gets closer to the current year. I expected a drop off because it probably takes most people a certain number of years of life to become notable enough to get a Wikipedia page. While I don't do this here, I think it would be an interesting analysis to see if one could calculate the average age at which a person receives an entry to Wikipedia. A fun sub-analysis would be to see if there are differences in the ages by category of notability. For example, I expect that athletes would have a younger age of first entry compared to Nobel Laureates.

Another notable trend is that the birth count is high at the start of centuries (eg 1100) compared to intervening years with blunting in that phenomenon from 1500 onward and disappearing around 1800. My instinct is that this reflects the improvement in record keeping and preservation as we approach modern times. 

# Sex based differences

My prediction prior to exploring the distribution is that women are represented at lower rates in the data compared to men. Graphing the data, confirms this. I suppose the surprising insight from the graph is that the proportion of women represented in the data from about 1500 to 1800.

```{r, message=FALSE, warning=FALSE, echo=FALSE}
male_color <- "#2E45B8"
female_color <- "#C91D42"

sex_proportion_plot <- my_wiki_query %>% 
  filter(simplified_sex == 1 | simplified_sex == 2) %>% 
  filter(full_year_of_birth >= 1000 & full_year_of_birth < 2021) %>% 
#  group_by(decade_birth) %>% 
  ggplot(aes(x = full_year_of_birth, fill = simplified_sex, color = simplified_sex)) +
  geom_bar(position = "fill") +
  scale_fill_manual(labels = c("Female", "Male"), values = c(female_color, male_color)) +
  scale_color_manual(labels = c("Female", "Male"), values = c(female_color, male_color)) +
  labs(title = "Proportion of men and women over time in birth cohorts", 
       x = "Year of birth",
       y = " ", 
       fill = "Sex", 
       color = NULL) +
  geom_hline(yintercept = 0.5) +
  theme_economist() +
  scale_y_continuous(breaks=c(0, 0.25, .5, 0.75, 1), 
                     labels = c(" ", " ", "50%", " ", " ")) +
  scale_x_continuous(breaks = seq(1000, 2021, 100)) +
  guides(color = "none")

sex_proportion_plot
```
```{r, message=FALSE, warning=FALSE, echo=FALSE}
ce_dates <- my_wiki_query %>% 
  filter(full_year_of_birth >= 1000 & full_year_of_birth <= 2021) %>% 
  filter(full_year_of_death >= 1000 & full_year_of_birth <= 2021) %>% 
  mutate(date_of_birth = as_date(dob)) %>%
  mutate(year_birth = year(date_of_birth)) %>%
  mutate(month_birth = month(date_of_birth)) %>%
  mutate(day_birth = day(date_of_birth)) %>%
  mutate(date_of_death = as_date(dod)) %>%
  mutate(year_death = year(date_of_death)) %>%
  mutate(month_death = month(date_of_death)) %>%
  mutate(day_death = day(date_of_death)) %>%
  mutate(lifespan = as.duration(interval(date_of_birth, date_of_death))) %>% 
  filter(lifespan < years(123)) %>% 
  filter(lifespan >= years(0))
```

# Average age of death 

I considered two ways to visualize the average of death. The first way is by grouping birth year and seeing the average age of death for that group. As you can see in the graph below, the major issue with that approach is that years close to the present will have very low average ages for death. This happens because in years less than roughly 80 years prior to 2021, anyone who has died, died relatively 'young'. 

```{r, message=FALSE, warning=FALSE, echo=FALSE}
average_lifespan_by_sex <- ce_dates %>% 
  group_by(year_birth, simplified_sex) %>% 
  summarise(average_age = mean((lifespan)))

average_lifespan <- ce_dates %>% 
  group_by(year_birth) %>% 
  summarise(average_age = mean((lifespan)))

plot_average_lifespan <- average_lifespan %>%  
  ggplot(aes(x = year_birth, y = (average_age/31557600))) +
  geom_smooth(color = 	"#F97A1F") +
  geom_point(alpha = 0.05, color = 	"#F97A1F") +
  labs(title = "Average age over time",
       x = "Birth Year Cohort",
       y = "Age") 

plot_average_lifespan + theme_economist() + scale_x_continuous(breaks = seq(1000, 2021, 100))

average_lifespan_by_sex <- ce_dates %>% 
  group_by(year_birth, simplified_sex) %>% 
  summarise(average_age = mean((lifespan)))

plot_average_lifespan_by_sex <- average_lifespan_by_sex %>% 
  filter(simplified_sex != 3) %>% 
  ggplot(aes(x = year_birth, y = (average_age/31557600), color = simplified_sex)) +
  geom_smooth() +
  geom_point(alpha = 0.05) +
  scale_color_manual(labels = c("Female", "Male"), values = c(female_color, male_color)) +
  labs(title = "Average age over time by sex",
       x = "Birth Year Cohort",
       y = "Age", 
       color = "Sex") 

plot_average_lifespan_by_sex + theme_economist() + scale_x_continuous(breaks = seq(1000, 2021, 100)) 
```

To avoid this problem, I instead grouped by death year to show per year how old a person was on average that died that year. From these plots we see the average age of death for women flips to be higher than men in the early 20th century and continues until present time.

```{r, message=FALSE, warning=FALSE, echo=FALSE}
average_lifespan_by_sex_dc <- ce_dates %>% 
  group_by(year_death, simplified_sex) %>% 
  summarise(average_age = mean((lifespan)))

average_lifespan_dc <- ce_dates %>% 
  group_by(year_death) %>% 
  summarise(average_age = mean((lifespan)))

plot_average_lifespan_dc <- average_lifespan_dc %>%  
  ggplot(aes(x = year_death, y = (average_age/31557600))) +
  geom_smooth(color = 	"#F97A1F") +
  geom_point(alpha = 0.05, color = 	"#F97A1F") +
  labs(title = "Average age over time",
       x = "Death Year Cohort",
       y = "Age") 

plot_average_lifespan_dc  + theme_economist() + scale_x_continuous(breaks = seq(1000, 2021, 100))

plot_average_lifespan_by_sex_dc <- average_lifespan_by_sex_dc %>% 
  filter(simplified_sex != 3) %>% 
  ggplot(aes(x = year_death, y = (average_age/31557600), color = simplified_sex)) +
  geom_smooth() +
  geom_point(alpha = 0.05) +
  scale_color_manual(labels = c("Female", "Male"), values = c(female_color, male_color)) +
  labs(title = "Average age over time by sex",
       x = "Death Year Cohort",
       y = "Age", 
       color = "Sex") 

plot_average_lifespan_by_sex_dc + theme_economist() + scale_x_continuous(breaks = seq(1000, 2021, 100))
```

To compare to tweet 1, I need to exclude deaths that occurred at 20 or under. By examining my plot verses that tweet, it is difficult to compare because I don't know what smoothing function that the person used to calculate their line. The data before about 1600 has much more variability that data after that point. 

```{r}
average_lifespan_dc_20 <- ce_dates %>% 
  filter(lifespan > 630720000) %>% 
  group_by(year_death) %>% 
  summarise(average_age = mean((lifespan)))

plot_average_lifespan_dc_20 <- average_lifespan_dc_20  %>%  
  ggplot(aes(x = year_death, y = (average_age/31557600))) +
  geom_smooth(color = 	"#F97A1F") +
  geom_point(alpha = 0.05, color = 	"#F97A1F") +
  labs(title = "Average age over time",
       subtitle = "Only lifespans greater than 20 years",
       x = "Death Year Cohort",
       y = "Age") 

plot_average_lifespan_dc_20 + theme_economist() + scale_x_continuous(breaks = seq(1000, 2021, 100))
```


Given this, I then investigated what the average age of death looks like from 1600 onward. 

```{r, message=FALSE, warning=FALSE, echo=FALSE}
plot_average_lifespan_dc <- average_lifespan_dc %>%  
  filter(year_death >= 1600) %>% 
  ggplot(aes(x = year_death, y = (average_age/31557600))) +
  geom_smooth(color = 	"#F97A1F") +
  geom_point(alpha = 0.05, color = 	"#F97A1F") +
  labs(title = "Average age over time",
       x = "Death Year Cohort",
       y = "Age") 

plot_average_lifespan_dc + 
  theme_economist() + 
  scale_x_continuous(breaks = seq(1000, 2021, 100)) + 
    coord_cartesian(ylim = c(40, 90))

plot_average_lifespan_by_sex_dc <- average_lifespan_by_sex_dc %>% 
  filter(year_death >= 1600) %>% 
  filter(simplified_sex != 3) %>% 
  ggplot(aes(x = year_death, y = (average_age/31557600), color = simplified_sex)) +
  geom_smooth() +
  geom_point(alpha = 0.05) +
  scale_color_manual(labels = c("Female", "Male"), values = c(female_color, male_color)) +
  labs(title = "Average age over time by sex",
       x = "Death Year Cohort",
       y = "Age", 
       color = "Sex") +
  guides(color = "none")

plot_average_lifespan_by_sex_dc + 
  theme_economist() + 
  scale_x_continuous(breaks = seq(1000, 2021, 100)) + 
  coord_cartesian(ylim = c(40, 90))
```

Finally, let's look at the data from 1800 onward to investigate the huge expected impacts of both World Wars. While we can see the huge impact on age of death in the 1914 - 1918 and 1939 - 1945, I was surprised to see that the average age of death for both men and women was so affected given that I anticipated that men, who are the primary actors in military actions, would have taken a bigger hit than women. While beyond the scope of this post, I think there might be something mysterious going on in the data around the turn of the 21st century with a spike upwards in both sex's average age of death.

```{r}
year_cutoff <- 1800

plot_average_lifespan_dc <- average_lifespan_dc %>%  
  filter(year_death >= year_cutoff) %>% 
  ggplot(aes(x = year_death, y = (average_age/31557600))) +
  geom_line(color = 	"#F97A1F") +
 # geom_point(alpha = 0.05, color = 	"#F97A1F") +
  labs(title = "Average age over time",
       x = "Death Year Cohort",
       y = "Age") 

plot_average_lifespan_dc + 
  theme_economist() + 
  scale_x_continuous(breaks = seq(1000, 2021, 100)) + 
    coord_cartesian(ylim = c(40, 90))

plot_average_lifespan_by_sex_dc <- average_lifespan_by_sex_dc %>% 
  filter(year_death >= year_cutoff) %>% 
  filter(simplified_sex != 3) %>% 
  ggplot(aes(x = year_death, y = (average_age/31557600), color = simplified_sex)) +
  geom_line() +
  scale_color_manual(labels = c("Female", "Male"), values = c(female_color, male_color)) +
  labs(title = "Average age over time by sex",
       x = "Death Year Cohort",
       y = "Age", 
       color = "Sex") +
  guides(color = "none")

plot_average_lifespan_by_sex_dc + 
  theme_economist() + 
  scale_x_continuous(breaks = seq(1000, 2021, 100)) + 
  coord_cartesian(ylim = c(40, 90))
```


# Dirty data

Speaking of data issues, the final part of my analysis I'd like to share is how many birth dates in the data are represented at higher rates than expected. As mentioned above, before 1800, many people had birth years listed as years like 1000 or 1300. Here I'll also show how uncertainty of the day of births can be seen in the data. 

The plot below shows a yellow dot for date that has a 10% or greater number of birth dates than expected with the assumption that birth days will be distributed equally throughout the year. Notice the nearly straight lines on the y-axis which represents birth dates that fall on the start of a month. 


```{r, message=FALSE, warning=FALSE, echo=FALSE}
heatmap_dates <- ce_dates %>% 
  mutate(pad_month_birth = str_pad(month_birth, width = 2, side = "left", pad = 0)) %>% 
  mutate(pad_day_birth = str_pad(day_birth, width = 2, side = "left", pad = 0)) %>% 
  unite("heatdate", c(year_birth, pad_month_birth, pad_day_birth), sep = "-", remove = FALSE) %>% 
  mutate(doy = lubridate::yday(as_date(heatdate)))

heatmap_dates_subset <- heatmap_dates %>% dplyr::select(year_birth, heatdate, doy)

heatmap_data <- heatmap_dates_subset %>% 
  group_by(year_birth, doy) %>% 
  summarise(count = n()) %>% 
  ungroup() %>% 
  group_by(year_birth) %>% 
  mutate(year_total = sum(count)) %>% 
  mutate(proportion_year = count/year_total) %>% 
  mutate(too_high = case_when(
    proportion_year > 0.003 ~ 1, #roughly 10% higher than expected
    TRUE ~ 0
  ))


too_many_births_plot <- heatmap_data  %>% 
  filter(year_birth >= 1500) %>% 
  ggplot(aes(x = year_birth, y = doy, fill = too_high, text = )) + 
  geom_tile() +
  scale_fill_gradient(low = "#475ED1", high = "#F9C31F") + # mid 
  theme_economist() +
  theme(legend.position = "none") +
  labs(x = "Year", 
       y = " ", 
       title = "Days of the year with more than expected birthdates",
       subtitle = "Yellow represents with \"too\" many births \nY-axis is the day of the year with tick marks to show the start of the month") +
  scale_y_continuous(breaks=c(1, 32, 60, 91, 121, 152, 182, 213, 244, 274, 305, 335),
                     labels = c("J", "F", "M", "A", "M", "J", "J", "A", "S", "O", "N", "D"))

too_many_births_plot
```
Difficult to see on the graph above, here is a zoomed in version looking only at January birth dates. Here you can see that January 1st is overrepresented in the data for literally ever year in the day from 1000 to 2021!

```{r}
too_many_births_plot <- heatmap_data  %>% 
  filter(doy < 31) %>% 
  ggplot(aes(x = year_birth, y = doy, fill = too_high, text = )) + 
  geom_tile() +
  scale_fill_gradient(low = "#475ED1", high = "#F9C31F") + # mid 
  theme_economist() +
  theme(legend.position = "none") +
  labs(x = "Year", 
       y = " ", 
       title = "Days of the year with more than expected birthdates",
       subtitle = "Yellow represents with \"too\" many births \nY-axis is the day of the year with tick marks to show the start of the month") +
  scale_y_continuous(breaks=c(1, 32, 60, 91, 121, 152, 182, 213, 244, 274, 305, 335),
                     labels = c("J", "F", "M", "A", "M", "J", "J", "A", "S", "O", "N", "D"))

too_many_births_plot
```
# Wrap up

I hope you have enjoyed my mini-journey of exploring the average age of the death over time. It only took me 17 months to finally finish it! 

# Technical notes

For anyone wanting to reproduce my work, you can see my R session information below. Raw code below as well. Your data will likely be different than mine as the data pull for this post was done on November 6, 2021. 

```{r ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE}

```


```{r}
sessionInfo()
```



# What do to do with missing data

I know missing data is big headache for a lot of folks, and I don't want to trivialize the issue, so this is me acknowledging this is not how one should solve the following problem, but it **is** how I will deal with it today. There are tons of people without birth and death dates, so I am going to throw the baby out with the bath water and only keep entries for folks with a birth and death dates.

```{r eliminate-nas}

processed_data <- my_wiki_query %>% 
  drop_na(dob) %>% 
  drop_na(dod)

my_wiki_query %>% group_by(item) %>% summarise(count = n())
```

This roughly halves the data with number of entries in the original data being `r nrow(my_wiki_query)` now to `r nrow(processed_data)`. I imagines one of the most remarkable effects on the data will be how this affects the data born in the 20th and 21st centuries because people who are living currently will not be in the data and people who have died young at the end of the dataset will be overrepresented compared to prior birth cohorts who have had enough time to grow old and die. I bet there are epidemiology people who make a career out of understanding that issue and it's effects on data.

# Dates, never easy

Currently there's not a super easy way to deal with BC dates in R (which I am using for this analysis) so I am restricting my analysis to people who have AD birth dates. 


# Negative life

```{r positive}
positive_lifespan <- ce_dates %>% filter(lifespan >= 0)

ce_dates  %<>% filter(lifespan >= 0 | is.na(lifespan)) 
```

So the data contains some negative lifespans. I took a peek at [one of the entries](https://www.wikidata.org/wiki/Q81098) and found a fun little wrench in all my pretty data. Some folks have dates of birth and death recorded as things like _18th century_ so when trying to do different calculations you get a negative number. I'll slice these folks out, which removes `r nrows(ce_dates) - nrows(positive_lifespan)` entries. 

# Finally a plot, bad

So here's the first plot

```{r}
plot <- positive_lifespan %>% 
  ggplot(aes(x = ymd(date_of_birth), y = (lifespan/31556952))) +
  geom_point() +
  scale_x_date() +
  labs(x = "Date of Birth", y = "Life in Years")

plot
```
As I predicted there is some really stark blunting of lifespan at the end of the dataset.

There are also some folks with really long lives...let's take a look at this [Methuselahian](https://en.wikipedia.org/wiki/Methuselah) cohort. 

```{r}
too_long_life <- positive_lifespan %>% filter(lifespan > years(120))

test <- top_n(too_long_life, 10) 

test$url <- paste0("<a href='",test$item,"'>",test$item,"</a>")

test %>% 
  select(lifespan, url, date_of_birth, date_of_death) %>% 
  DT::datatable(escape = FALSE)
```

This too looks like some issues with a birth or death date of something like _21st century_ or just some likely wrong values. I'm gonna exclude anyone older than 122 which is the oldest verified person ([which is not without controversy](https://en.wikipedia.org/wiki/Jeanne_Calment#Skepticism_regarding_age)) but is fine enough for this rough project. 

```{r}
ce_data_histogram <- ce_dates %>% 
  group_by(year_birth) %>% 
  ggplot(aes(x = year_birth)) +
  geom_histogram(binwidth = 10) +
  scale_y_log10() +
  theme_economist()

ce_data_histogram 
```

```{r}
upper_bound_life <- positive_lifespan %>% filter(lifespan < years(123))
```

```{r}
plot_2 <- upper_bound_life %>% 
  ggplot(aes(x = ymd(date_of_birth), y = (lifespan/31556952))) +
  geom_point(alpha = 0.05) +
  scale_x_date() +
  labs(x = "Date of Birth", y = "Life in Years")

plot_2
```

```{r}
average_ages_by_birth_year <- upper_bound_life %>% 
  dplyr::group_by(year_birth) %>% 
  dplyr::summarise(mean_death_age = mean(lifespan), birth_cohort_size = n(), sd_lifespan = sd(lifespan))


plot_average_ages_by_birth_year <- ggplot(average_ages_by_birth_year, aes(x = year_birth, y = mean_death_age)) +
  geom_smooth()

plot_average_ages_by_birth_year


```
That is a hilariously overplotted graph. What I really want to know is how the average age changed over time, so I'm gonna group the data by birth year, get average lifespan and plot that. Males and females have different average life expectenacies so would like to look at that too in the data. I also know that there is likely to be a big difference in who gets a Wikipedia page and is likely to have more men compared to women, so that will be interesting to see that graphed out too!

Again going for some super simple analysis here. There are entries that have sex or gender not as male or female, but the numbers for each category are fairly small, so I'm going to do a split of female, male, and group everything not those two in one category. 






```{r average_age}
average_lifespan <- upper_bound_life %>% 
  group_by(year_birth, simplified_sex) %>% 
  summarise(average_age = mean((lifespan)))
```

```{r average_plot}
time_breaks <- seq(0,2100, by = 100)
plot_average <- average_lifespan %>%
  ggplot(aes(x = year_birth, y = average_age/31556952)) +
  geom_smooth() +
  labs(x = "Year of birth", y = "Average lifespan (years) for birth year cohort") +
  scale_x_continuous(breaks = c(time_breaks)) +
  facet_wrap(simplified_sex ~ .)

plot_average
```

Lots of issues with big outliers for not so clean data. Looks like tons of folks are listed as having years of birth that line up with round years like 1700. Let's just look at folks born on or after 1800.



```{r on_or_after_1800}
plot_average_post1800 <- average_lifespan %>%
  filter(year_birth >= 1800) %>% 
  ggplot(aes(x = year_birth, y = average_age/31556952)) +
  geom_line() +
  labs(x = "Year of birth", y = "Average lifespan (years) for birth year cohort") 

plot_average_post1800
```

# Distribution of years, months, days

Let's create a variable to that captures the century of birth (eg if born in 1893, will be 18)
```{r}
upper_bound_life %<>% 
  mutate(year_4_digits = str_pad(year_birth, width = 4, pad = 0)) %>% 
  mutate(century = str_sub(year_4_digits, 1, 2)) %>% 
  group_by(century) %>% 
  mutate(mean_by_century = (mean(lifespan))) %>% 
  ungroup()
  
```

```{r}
death_year <-
  upper_bound_life %>% 
  dplyr::group_by(year_death) %>% 
  dplyr::summarise(count = n()) %>% 
  dplyr::ungroup()
```


```{r}
death_year_summary <-
  upper_bound_life %>% 
  group_by(year_death) %>% 
  dplyr::summarise(death_count = n()) 

birth_year_summary <-
  upper_bound_life %>% 
  group_by(year_birth) %>% 
  dplyr::summarise(birth_count = n()) 

deaths_per_year_plot <- death_year_summary %>% 
  filter(year_death >= 1600 ) %>% 
  ggplot(aes(x = year_death, y = death_count)) + 
  geom_line() +
  labs(title = "Deaths per year since 1600", x = "Year", y = "Death Count")

ggplotly(deaths_per_year_plot)



births_per_year_plot <- birth_year_summary %>% 
  filter(year_birth >= 1600 ) %>% 
  ggplot(aes(x = year_birth, y = birth_count)) + 
  geom_line() +
  labs(title = "Births per year since 1600 for entries of deceased people", x = "Year", y = "Birth Count")

ggplotly(births_per_year_plot)
```

Remember the above data **only** contains folks who have known birth and death dates, so for the latter half of the 20th century and beginning of the 21st, there are very few counts. 




```{r}

distribution_months_death <- ggplot(upper_bound_life, aes(x = month(month_death, label = TRUE))) + 
  geom_bar() + 
  ggtitle("Distribution of Deaths Among Months") +
  labs(x = "Month of Death", y = "Number of Deaths") 

distribution_months_death
```

```{r}
distribution_days_death <- ggplot(upper_bound_life, aes(x = lubridate::day(date_of_death))) + 
  geom_bar() + 
  ggtitle("Distribution of Deaths Among Days") +
  labs(x = "Day of Death", y = "Number of Deaths") 

distribution_days_death
```
```{r}
distribution_days_birth <- ggplot(upper_bound_life, aes(x = lubridate::day(date_of_birth))) + 
  geom_bar() + 
  ggtitle("Distribution of Births Among Days") +
  labs(x = "Day of Births", y = "Number of Births") 

distribution_days_birth
```
```{r}
distribution_wdays_birth <- ggplot(upper_bound_life, aes(x = lubridate::wday(date_of_birth, label = TRUE))) + 
  geom_bar() + 
  ggtitle("Distribution of Births Among Days of the Week") +
  labs(x = "Day of Births", y = "Number of Births") 

distribution_wdays_birth
```

I thought that day of week would be interesting, but upon reflection given that the first day of the month is hugely overweighted in the data and that the first day of the month is *probably* evenly distributed among the days of the week, it propbably obscures anything else in the data.